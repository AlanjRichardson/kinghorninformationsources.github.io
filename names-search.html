<!DOCTYPE html>
<html lang="en">
<head>
  
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-20KZGF4994"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-20KZGF4994');
</script>
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Name-Search</title>
  <link rel="stylesheet" href="kinghorn.css">
</head>
  
  <script src="people-data.js"></script>
</head>

<body>
  <header>
    <h1>Kinghorn Information Sources</h1>
    <button class="navbar-toggler" aria-label="Toggle menu">☰</button>
    <nav>
      <ul class="navbar-nav">
        <li><a href="index.html">Home</a></li>
        <li><a href="kinghorn_history.html">Historical</a></li>
        <li><a href="industryhistory.html">Industrial</a></li>
        <li><a href="naturalhistory.html">Natural</a></li>
        <li><a href="maps.html">Old-Maps</a></li>
        <li><a href="documents.html">Documents</a></li>
        <li><a href="Software.html">Software</a></li>
        <li><a href="Culture.html">People</a></li>
        <li><a href="names-search.html">Name Search</a></li>
      </ul>
    </nav>
  </header>

  <main>
  <h2>Photo Name Search</h2>
  <p>
    Use this page to search the Kinghorn Photos with Names album.
    Enter the first three letters or more of a surname (for example, <strong>McA</strong> for McAndrew)
    to see the photo file(s) they appear in. Make a note of the photo file(s) and visit
    <a href="https://drive.google.com/drive/folders/0B_ryY5OKr0WyRlZxUmVBUU0wbjg?resourcekey=0--wTJ-afNjfmQDnNBqjaA9g&usp=sharing" target="_blank">
      Kinghorn Photos with Names Album
    </a> noting that the filenames there are organised in alphabetical order.
  </p>

  <div id="name-search-panel">
    <label for="surnameInput">
      Surname (first 3 letters or more):
    </label>
    <input type="text"
           id="surnameInput"
           maxlength="20"
           placeholder="e.g. McA">

    <button type="button" onclick="performSearch()">Search</button>
    <button type="button" onclick="clearSearch()">Clear</button>

    <!-- New controls -->
    <button type="button" onclick="showSelected()">Show selected</button>
    <button type="button" onclick="copySelected()">Copy selected</button>
    <button type="button" onclick="clearSelected()">Clear selected</button>
    <button type="button" onclick="openDriveFolder()">Open Album</button>

    <div id="resultsInfo"></div>

    <p style="margin-top:10px;">
      <small>
        Tip: tick the relevant entries, click <strong>Copy selected</strong>,
        then click <strong>Open Album</strong> and paste a filename into the Drive search box.
      </small>
    </p>
  </div>

  <div id="resultsArea"></div>
</main>

<footer>
  Editor: Alan Richardson <a href="ContactForm.html">Contact me by email</a>
</footer>

<!-- Existing menu toggler script -->
<script>
  const toggler = document.querySelector('.navbar-toggler');
  const navMenu = document.querySelector('.navbar-nav');
  const body = document.body;

  if (toggler && navMenu) {
    toggler.addEventListener('click', () => {
      navMenu.classList.toggle('show');
      body.classList.toggle('menu-active');
    });
  }
</script>

<!-- Search logic + selection -->
<script>
  // Stores selected entries (Full Name + Photo file) across searches on this page load
  const selectedEntries = new Map(); // key: "fullName||photoFile" -> { fullName, photoFile }

  const DRIVE_FOLDER_URL =
    "https://drive.google.com/drive/folders/0B_ryY5OKr0WyRlZxUmVBUU0wbjg?resourcekey=0--wTJ-afNjfmQDnNBqjaA9g&usp=sharing";

  function openDriveFolder() {
    window.open(DRIVE_FOLDER_URL, "_blank", "noopener,noreferrer");
  }

  function updateResultsInfo(matchCount = null, message = null) {
    const resultsInfo = document.getElementById('resultsInfo');
    if (!resultsInfo) return;

    if (message) {
      resultsInfo.textContent = message;
      return;
    }

    const selCount = selectedEntries.size;

    if (matchCount !== null) {
      resultsInfo.textContent =
        `${matchCount} result${matchCount === 1 ? '' : 's'} found. ` +
        `Selected entries: ${selCount}`;
    } else {
      resultsInfo.textContent = `Selected entries: ${selCount}`;
    }
  }

  function performSearch() {
    const input = document.getElementById('surnameInput');
    const prefix = input.value.trim().toLowerCase();
    const resultsArea = document.getElementById('resultsArea');

    resultsArea.innerHTML = '';

    if (prefix.length < 3) {
      updateResultsInfo(null, 'Please enter at least 3 letters of a surname.');
      return;
    }

    // Filter people by surname prefix (case-insensitive)
    const matches = people.filter(p =>
      p.surname && p.surname.toLowerCase().startsWith(prefix)
    );

    if (matches.length === 0) {
      updateResultsInfo(null, 'No matches found.');
      resultsArea.innerHTML = '<p><em>No people found with that surname prefix.</em></p>';
      return;
    }

    // Build results table (with checkboxes)
    let html = '';
    html += '<table>';
    html += '<thead><tr>' +
            '<th>Select</th>' +
            '<th>Surname</th>' +
            '<th>Full name</th>' +
            '<th>Photo file</th>' +
            '</tr></thead><tbody>';

    matches.forEach((p, idx) => {
      const surnameRaw = p.surname || '';
      const fullNameRaw = p.fullName || '';
      const photoRaw = p.photoFile || '';

      const surname = escapeHtml(surnameRaw);
      const fullName = escapeHtml(fullNameRaw);
      const photo = escapeHtml(photoRaw);

      const key = `${fullNameRaw}||${photoRaw}`;
      const checked = selectedEntries.has(key) ? 'checked' : '';

      html += '<tr>' +
              `<td><input type="checkbox"
                    data-fullname="${escapeAttr(fullNameRaw)}"
                    data-photo="${escapeAttr(photoRaw)}"
                    ${checked}
                    onchange="toggleSelected(this)"></td>` +
              `<td>${surname}</td>` +
              `<td>${fullName}</td>` +
              `<td>${photo}</td>` +
              '</tr>';
    });

    html += '</tbody></table>';
    resultsArea.innerHTML = html;

    updateResultsInfo(matches.length);
  }

  function toggleSelected(checkbox) {
    const fullName = checkbox.getAttribute('data-fullname') || '';
    const photo = checkbox.getAttribute('data-photo') || '';
    if (!fullName || !photo) return;

    const key = `${fullName}||${photo}`;

    if (checkbox.checked) {
      selectedEntries.set(key, { fullName, photoFile: photo });
    } else {
      selectedEntries.delete(key);
    }

    // Keep the count visible
    updateResultsInfo(null);
  }

  function showSelected() {
    const resultsArea = document.getElementById('resultsArea');

    if (selectedEntries.size === 0) {
      updateResultsInfo(null, 'No selected entries yet.');
      resultsArea.innerHTML = '';
      return;
    }

    const items = Array.from(selectedEntries.values())
      .sort((a, b) => {
        const s = a.fullName.localeCompare(b.fullName);
        return s !== 0 ? s : a.photoFile.localeCompare(b.photoFile);
      });

    let html = '<h3>Selected entries (Full name — Photo file)</h3>';
    html += '<ul>';
    items.forEach(item => {
      html += `<li>${escapeHtml(item.fullName)} — ${escapeHtml(item.photoFile)}</li>`;
    });
    html += '</ul>';

    resultsArea.innerHTML = html;
    updateResultsInfo(null);
  }

  async function copySelected() {
    if (selectedEntries.size === 0) {
      updateResultsInfo(null, 'No selected entries to copy.');
      return;
    }

    const lines = Array.from(selectedEntries.values())
      .sort((a, b) => {
        const s = a.fullName.localeCompare(b.fullName);
        return s !== 0 ? s : a.photoFile.localeCompare(b.photoFile);
      })
      .map(item => `${item.fullName} — ${item.photoFile}`);

    const text = lines.join('\n');

    try {
      await navigator.clipboard.writeText(text);
      updateResultsInfo(null, `Copied ${selectedEntries.size} selected entr${selectedEntries.size === 1 ? 'y' : 'ies'} to clipboard.`);
    } catch (e) {
      window.prompt("Copy the selected entries:", text);
    }
  }

  function clearSelected() {
    selectedEntries.clear();
    updateResultsInfo(null, 'Selected entries cleared.');

    // If a search is visible, refresh it so checkboxes clear
    const prefix = document.getElementById('surnameInput').value.trim();
    if (prefix.length >= 3) performSearch();
    else document.getElementById('resultsArea').innerHTML = '';
  }

  function clearSearch() {
    document.getElementById('surnameInput').value = '';
    document.getElementById('resultsArea').innerHTML = '';
    updateResultsInfo(null);
    document.getElementById('surnameInput').focus();
  }

  function escapeHtml(text) {
    if (!text) return '';
    return text
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  }

  function escapeAttr(text) {
    if (!text) return '';
    return text
      .replace(/&/g, '&amp;')
      .replace(/"/g, '&quot;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');
  }

  // Allow Enter key to trigger the search
  document.getElementById('surnameInput').addEventListener('keydown', function (e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      performSearch();
    }
  });
</script>


</body>
</html>



  <script>
  const toggler = document.querySelector('.navbar-toggler');
  const navMenu = document.querySelector('.navbar-nav');
  const body = document.body;

  if (toggler && navMenu) {
    toggler.addEventListener('click', () => {
      navMenu.classList.toggle('show');
      body.classList.toggle('menu-active');
    });
  }
</script>

 
  
</body>
</html>
